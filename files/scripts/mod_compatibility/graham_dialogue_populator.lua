-- Graham is quite the cool fellow :p

--Now is all this dialogue "canon"? uhhh idk probably not this is mostly for fun

--Spoop made

AddEnemyDialogue(pools.IDLE, "$enemy_apotheosis_fairy", {"Glow!", "Shine sparkle...", "Glint glint?"})
AddEnemyDialogue(pools.DAMAGETAKEN, "$enemy_apotheosis_fairy", {"Dim...", "Whimper...", "Dull..."})
AddEnemyDialogue(pools.DAMAGEDEALT, "$enemy_apotheosis_fairy", {"April fool!", "You thought we were so innocent?", "Shine this!"})

AddEnemyDialogue(pools.IDLE, "$enemy_apotheosis_whisp", {"Flame!", "Scorch ember...", "Spark spark?"})
AddEnemyDialogue(pools.DAMAGETAKEN, "$enemy_apotheosis_whisp", {"Fizzle...", "Snuff...", "Extinguish..."})
AddEnemyDialogue(pools.DAMAGEDEALT, "$enemy_apotheosis_whisp", {"Burn burn!", "Ablaze!", "Smolder!"})

AddEnemyDialogue(pools.IDLE, "$enemy_apotheosis_whisp_big", {"We're reborn anew, with a heart of fire.", "An inferno will be razed!", "Many can't handle the heat..."})
AddEnemyDialogue(pools.DAMAGETAKEN, "$enemy_apotheosis_whisp_big", {"You will boil! Booill!", "You'll never snuff me!", "You're just kindle for my flame..."})
AddEnemyDialogue(pools.DAMAGEDEALT, "$enemy_apotheosis_whisp_big", {"I hope that stings...", "Feelin' the burn?", "You'll smolder out soon enough..."})

AddEnemyDialogue(pools.IDLE, "$enemy_apotheosis_hiisi_thief", {"Keep this between you and me...", "Hey! You're lookin' unsuspecting!", "Can't pay rent these days..."})
AddEnemyDialogue(pools.DAMAGETAKEN, "$enemy_apotheosis_hiisi_thief", {"You got guts outwittin' me!", "You better watch your back!", "Howsabout I steal your life next?"})
AddEnemyDialogue(pools.DAMAGEDEALT, "$enemy_apotheosis_hiisi_thief", {"Thanks for the small donation!", "Hahahahaha!", "Yoink!"})

AddEnemyDialogue(pools.IDLE, "$enemy_apotheosis_spirit_healing", {"When one dies when others are in need... That's me!", "Keep on going, you got this!", "Your time's not over just yet!"})
AddEnemyDialogue(pools.DAMAGETAKEN, "$enemy_apotheosis_spirit_healing", {"Hey stop! I only wish to give life to others!", "Why must you bring death in life?", "What are you doing!?"})
AddEnemyDialogue(pools.DAMAGEDEALT, "$enemy_apotheosis_spirit_healing", {"Oh no! Are you okay?", "Ah! I don't know my own capabilities!", "Keep away! I don't know what's happening!"})

AddEnemyDialogue(pools.IDLE, "$enemy_apotheosis_wizard_corrupt_hearty", {"My favourite colour? A scarlet red.", "The damage is irreversible...", "Don't you know it's rude to stare?"})
AddEnemyDialogue(pools.DAMAGETAKEN, "$enemy_apotheosis_wizard_corrupt_hearty", {"", "", ""})
AddEnemyDialogue(pools.DAMAGEDEALT, "$enemy_apotheosis_wizard_corrupt_hearty", {"", "", ""})

AddEnemyDialogue(pools.IDLE, "$enemy_apotheosis_wizard_corrupt_neutral", {"My favourite colour? A dull silver.", "Your signal is wavering, let me stabilize it.", "Everything's so fuzzy..."})

AddEnemyDialogue(pools.IDLE, "$enemy_apotheosis_wizard_corrupt_poly", {"My favourite colour? A dreary pink.", "Can't get enough of myself!", "The world would be a much better place with more me!"})
AddEnemyDialogue(pools.DAMAGETAKEN, "$enemy_apotheosis_wizard_corrupt_poly", {"", "", ""})
AddEnemyDialogue(pools.DAMAGEDEALT, "$enemy_apotheosis_wizard_corrupt_poly", {"", "", ""})

AddEnemyDialogue(pools.IDLE, "$enemy_apotheosis_wizard_corrupt_swapper", {"My favourite colour? A pale blue.", "Why can't everyone have as much fun as me?", "There's so little room for fun anymore..."})
AddEnemyDialogue(pools.DAMAGETAKEN, "$enemy_apotheosis_wizard_corrupt_swapper", {"", "", ""})
AddEnemyDialogue(pools.DAMAGEDEALT, "$enemy_apotheosis_wizard_corrupt_swapper", {"", "", ""})

AddEnemyDialogue(pools.IDLE, "$enemy_apotheosis_wizard_corrupt_teleport", {"My favourite colour? A sickly yellow.", "Stay stable, lest you end up like me...", "Sometimes it's better to stop for a moment."})
AddEnemyDialogue(pools.DAMAGETAKEN, "$enemy_apotheosis_wizard_corrupt_teleport", {"", "", ""})
AddEnemyDialogue(pools.DAMAGEDEALT, "$enemy_apotheosis_wizard_corrupt_teleport", {"Hold on, stay a while.", "Always in a hurry, rushing towards your goal yet making no progress.", "Take in your surroundings, stop running away."})

AddEnemyDialogue(pools.IDLE, "$enemy_apotheosis_wizard_corrupt_twitchy", {"My f-favourite colour? A b-bitter green.", "Chatter ch-chatter chatter...", "W-we w-will keep on r-resisting!"})
AddEnemyDialogue(pools.DAMAGETAKEN, "$enemy_apotheosis_wizard_corrupt_twitchy", {"", "", ""})
AddEnemyDialogue(pools.DAMAGEDEALT, "$enemy_apotheosis_wizard_corrupt_twitchy", {"", "", ""})

AddEnemyDialogue(pools.IDLE, "$enemy_apotheosis_wizard_corrupt_weaken", {"My favourite colour? A sharp white.", "We all have our flaws... how well can you hide yours?", "We all know what your weakness is."})
AddEnemyDialogue(pools.DAMAGETAKEN, "$enemy_apotheosis_wizard_corrupt_weaken", {"", "", ""})
AddEnemyDialogue(pools.DAMAGEDEALT, "$enemy_apotheosis_wizard_corrupt_weaken", {"", "", ""})

AddEnemyDialogue(pools.IDLE, "$enemy_apotheosis_wizard_corrupt_wands", {"My favourite colour? A cosmic violet.", "Maybe your wands don't trust you as much as you think...", "Possession is a fickle thing, watch how easy it is to change ownership..!"})
AddEnemyDialogue(pools.DAMAGETAKEN, "$enemy_apotheosis_wizard_corrupt_wands", {"", "", ""})
AddEnemyDialogue(pools.DAMAGEDEALT, "$enemy_apotheosis_wizard_corrupt_wands", {"Do you feel your power slipping?", "I'll be taking that off your hands.", "Clearly you don't know how to use that thing, let me handle it."})

AddEnemyDialogue(pools.IDLE, "$enemy_apotheosis_ant_fire", {"I have a brimstone stomach, you know.", "There's nothing a little spark of fire can't fix.", "It's smoldering up inside..."})
AddEnemyDialogue(pools.DAMAGETAKEN, "$enemy_apotheosis_ant_fire", {"I've lived through worse!", "We'll overpower you in numbers!", "Ow! That stings a little..."})
AddEnemyDialogue(pools.DAMAGEDEALT, "$enemy_apotheosis_ant_fire", {"Feeling a sting?", "Your body's very flammable you know!", "All this chemical reaction based evolution payed off!"})

AddEnemyDialogue(pools.IDLE, "$enemy_apotheosis_ant_suffocate", {"I have iron lungs, you know.", "There's nothing a few deep breaths can't fix.", "I'll take your breath away!"})
AddEnemyDialogue(pools.DAMAGETAKEN, "$enemy_apotheosis_ant_suffocate", {"I'm left speechless by this course of action...", "", ""})
AddEnemyDialogue(pools.DAMAGEDEALT, "$enemy_apotheosis_ant_suffocate", {"Breathtaking, aren't I?", "Got something in your throat?", "Now you're almost as blue as me!"})

AddEnemyDialogue(pools.IDLE, "$enemy_apotheosis_watermage", {"", "", ""})
AddEnemyDialogue(pools.DAMAGETAKEN, "$enemy_apotheosis_watermage", {"", "", ""})
AddEnemyDialogue(pools.DAMAGEDEALT, "$enemy_apotheosis_watermage", {"Take a deep breath, oh wait.", "", ""})

AddEnemyDialogue(pools.IDLE, "$enemy_apotheosis_watermage", {"", "", ""})
AddEnemyDialogue(pools.DAMAGETAKEN, "$enemy_apotheosis_watermage", {"", "", ""})
AddEnemyDialogue(pools.DAMAGEDEALT, "$enemy_apotheosis_watermage", {"Hold your breath for a little longer...", "", ""})

AddEnemyDialogue(pools.IDLE, "$enemy_apotheosis_waterskull", {"", "", ""})
AddEnemyDialogue(pools.DAMAGETAKEN, "$enemy_apotheosis_waterskull", {"", "", ""})
AddEnemyDialogue(pools.DAMAGEDEALT, "$enemy_apotheosis_waterskull", {"Keep it all in.", "", ""})

--Saving this for when I fully finish it
--[[
AddEnemyDialogue(pools.IDLE, "$enemy_apotheosis_boss_flesh_monster", 
{"How much value do you truly gift to your life?", 
"It took much strive to acquire such a stone...", 
"You're better off giving that artefact back...", 
"", 
"", 
""})
AddEnemyDialogue(pools.DAMAGETAKEN, "$enemy_apotheosis_boss_flesh_monster", 
{"These shackles shan't damper my pursuit.", 
"", 
"", 
"", 
"", 
""})
AddEnemyDialogue(pools.DAMAGEDEALT, "$enemy_apotheosis_boss_flesh_monster", 
{"There's an easier solution than this...", 
"", 
"", 
"", 
"", 
""})
]]--

--(mostly) Conga made

AddEnemyDialogue(pools.IDLE, "$enemy_apotheosis_fairy_big", {"We're bright as bright can be!", "I'll guide you through the darkness.", "Are you lost? Let me illuminate you..."})
AddEnemyDialogue(pools.DAMAGETAKEN, "$enemy_apotheosis_fairy_big", {"You can't dim this light!", "Why is it getting dark?", "You'll need to shine a lot brighter than that!"})
AddEnemyDialogue(pools.DAMAGEDEALT, "$enemy_apotheosis_fairy_big", {"Haha! Enter the light!", "You can't outrun the speed of light!", "Tag!"})

AddEnemyDialogue(pools.IDLE, "$enemy_apotheosis_slime_teleporter", {"It feels warm here.", "Do I look like a taxi?", "Where to next.."})
AddEnemyDialogue(pools.DAMAGETAKEN, "$enemy_apotheosis_slime_teleporter", {"", "", ""})
AddEnemyDialogue(pools.DAMAGEDEALT, "$enemy_apotheosis_slime_teleporter", {"You're not escaping that easily.", "We're not alone!", "Go go go! move in!"})

AddEnemyDialogue(pools.IDLE, "$", {"", "", ""})
AddEnemyDialogue(pools.DAMAGETAKEN, "$", {"", "", ""})
AddEnemyDialogue(pools.DAMAGEDEALT, "$", {"", "", ""})

Special_offsets_y["$enemy_apotheosis_fairy"] = -5
Special_offsets_y["$enemy_apotheosis_whisp"] = -5
Special_offsets_y["$enemy_apotheosis_fairy_big"] = -4
Special_offsets_y["$enemy_apotheosis_whisp_big"] = -4
Special_offsets_y["$enemy_apotheosis_boss_flesh_monster"] = 15

Special_sizes["$enemy_apotheosis_fairy"] = -0.10
Special_sizes["$enemy_apotheosis_whisp"] = -0.10
Special_sizes["$enemy_apotheosis_boss_flesh_monster"] = 0.45

local ApotheosisDialogue = ModdedStuff
function ModdedStuff()
    ApotheosisDialogue()
    Special_dialogue["$enemy_apotheosis_fairy_big"] = function(config)
	if config.pool == pools.IDLE then
		local bully_nearby = false
		local enemies = EntityGetInRadiusWithTag(config.x, config.y, 140, "flying")
		for i = 1, #enemies do
			if EntityGetName(enemies[i]) == "$enemy_apotheosis_whisp_big" then
				bully_nearby = true
				if Random(1, 3) == 1 then
					local special = {
						"How dare you!",
					}
					Speak(enemies[i], special[Random(1, #special)], pools.CUSTOM, true, true)
				end
				break
			end
		end
		if bully_nearby == true then
			local special = {
				"I shine much brighter than you!",
				"Evil Fairies! Go back to normal...",
				"Is your intelligence burning away too?",
			}
			config.text = special[Random(1, #special)]
		end
	end
    end

    Special_dialogue["$enemy_apotheosis_whisp_big"] = function(config)
	if config.pool == pools.IDLE then
		local bully_nearby = false
		local enemies = EntityGetInRadiusWithTag(config.x, config.y, 140, "flying")
		for i = 1, #enemies do
			if EntityGetName(enemies[i]) == "$enemy_apotheosis_fairy_big" then
				bully_nearby = true
				if Random(1, 3) == 1 then
					local special = {
						"You take that back!",
					}
					Speak(enemies[i], special[Random(1, #special)], pools.CUSTOM, true, true)
				end
				break
			end
		end
		if bully_nearby == true then
			local special = {
				"I burn much brighter than you...",
				"Where'd you get your wings from? The Hiisi store?",
				"Seems like you could use a bit of a spark of your own...",
			}
			config.text = special[Random(1, #special)]
		end
	end

        EntityAddComponent2(config.entity, "LuaComponent", {
            _tags = "graham_speech_removable",
            execute_every_n_frame = 1,
            script_source_file = "mods/grahamsdialogue/files/custom/lurker.lua"
        })
    end

    Special_dialogue["$enemy_apotheosis_wizard_corrupt_neutral"] = function(config)
	local comp = EntityGetFirstComponent(config.entity, "DamageModelComponent")
	local probability = 0.1
	if comp ~= nil then
	    local hp = ComponentGetValue2(comp, "hp")
	    local max_hp = ComponentGetValue2(comp, "max_hp")
	    if (hp <= max_hp * 0.5) then
		probability = 1 - ((hp * (100 / (max_hp * 0.55))) / 100)
	    end
	end
	local new = config.text
	new = replace_random_chars(new, probability)
	config.text = new
    end

    Special_dialogue["$enemy_apotheosis_boss_flesh_monster"] = function(config)
	config.font = "font_pixel_flesh"
	config.custom_font = true

	--[[
	local fleshy == false
	local spritecomps = EntityGetComponentIncludingDisabled(heretic_id, "SpriteComponent") or {}
	for i = 1, #spritecomps do
	    if ComponentGetValue2(spritecomps[i], "image_file") == "mods/Apotheosis/files/enemies_gfx/sacriligious_monster/flesh.png" then
		fleshy = true
		break
	    end
	end

	if config.pool == pools.IDLE then
		if GameHasFlagRun("apotheosis_miniboss_boss_flesh_monster_stone") then
			local idle = {
				"You still wish to disrupt me?",
				"You can't wish for it to be in your possession much more than I...",
				"It is better within' my grasp, there's a certain purpose it's meant to serve...",
				"",
				"",
				"",
			}
			if fleshy then
			    idle = {
				"Further disruption is ill-advised...",
				"You show quite the heedless want for this stone...",
				"",
				"",
				"",
				"",
			    }
			end
			config.text = idle[Random(1, #idle)]
		elseif fleshy then
			local idle = {
				"Return it, elsewise... endure the consequences.",
				"",
				"",
				"",
				"",
				"",
			}
			config.text = idle[Random(1, #idle)]
		end
	end
	]]--
    end
end

function replace_random_chars(s, replace_prob)
  replace_prob = replace_prob or 0.1
  return (s:gsub(".", function(c)
    if (c ~= ' ' and c ~= '!' and c ~= '?' and c ~= '.' and c ~= ',') and (math.random() < replace_prob) then
      return "#"
    else
      return c
    end
  end))
end